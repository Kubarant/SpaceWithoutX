const commands={run:{start:function(t,e){let i=Math.sign(e)>=0?"Right":"Left";t.acceleration.x+=e*t.runSpeedFactor,t.playAnimation("run"+i)},changeState:function(t,e,i){switch(t){case"jump":return e.velocity.x/=1.4,commands[t].start(e,i),commands[t];case"stay":case"duck":return commands[t].start(e,i),commands[t];case"run":return this.start(e,i),this}}},jump:{start:function(t,e){let i=Math.sign(t.velocity.x)>=0?"Right":"Left";t.acceleration.y+=e*t.jumpSpeedFactor,t.playAnimation("jump"+i)},changeState:function(t,e,i=0){switch(t){case"stay":return this.inAir(e)?this:(commands[t].start(e,i),commands[t]);case"run":return e.acceleration.x+=.8*i,this;case"jump":e.acceleration.y+=9;default:return this}},inAir:function(t){return 0!=Math.floor(t.velocity.y)}},duck:{start:function(t){let e=Math.sign(t.velocity.x)>=0?"Right":"Left";t.playAnimation("duck"+e),t.height=42},changeState:function(t,e,i=0){switch(t){case"stay":case"jump":if(this.unduck(e))return commands[t].start(e,i),commands[t];case"run":return e.acceleration.x+=.15*i,this;default:return this}},unduck:function(t){return!!t.collisionDetector.canGoXY(t,kontra.vector(0,-8),1)&&(t.height=50,t.realPosition.y-=8,!0)}},stay:{start:function(t,e){let i=Math.sign(t.velocity.x)>=0?"Right":"Left";t.playAnimation("stay"+i),t.acceleration=kontra.vector(0,0);let n=20*(1-t.slipImpact);t.velocity=kontra.vector(t.velocity.x*(.15+n),.15*t.velocity.y)},changeState:function(t,e,i=0){return commands[t].start(e,i),commands[t]}}};class MovingStateMachine{constructor(t){this.marine=t,this.currentState=commands.stay}changeState(t,e=0){this.currentState=this.currentState.changeState(t,this.marine,e)}setState(t){this.currentState=commands[t],this.currentState.start(this.marine,0)}}class Terminal{constructor(t,e){this.terminal=t,this.input=e,this.pairInput(e)}pairInput(t){t.addEventListener("keydown",e=>{if("Enter"===e.key){let e=t.value;t.value="",this.marineWrite(e),this.currentCommand.execute(e)&&(this.scrollDown(),this.currentCommand.winObserver.onWin(),this.currentCommand=cCommands[0])}})}marineWrite(t){this.terminal.innerHTML+="root@bloodraven:~$ "+t+"<br>",this.scrollDown()}writeln(t="",e="div",i="empty"){let n=document.createElement(e);n.innerHTML=t,n.classList.add("typing"),n.classList.add(i),n.animate([{width:"0"},{width:"100%"}],{duration:40*t.length}),this.terminal.appendChild(n),this.scrollDown()}execute(t,e={onWin:()=>{}}){this.currentCommand=this.findCommand(t),this.currentCommand.winObserver=e,this.currentCommand.init(this)}findCommand(t){for(let e of cCommands)if(e.command===t)return e;return cCommands[0]}focus(){this.terminal.focus()}clear(){this.terminal.innerHTML=""}scrollDown(){this.terminal.scrollTop=this.terminal.scrollHeight}}let cCommands=[{command:"nocommand",init:function(t){},execute:function(t){return!1}},{command:"start",init:function(t){t.writeln("Controls:<br>arrow up- jump<br>arrow down- duck<br>arrow left/right run<br>tab- switch to terminal<br>e- connect with computer tile<br><br>"),t.writeln("Your and your crew need to get to the<br> teleport before explosions kill you.<br>You need to hack computer tiles to open doors for your crew<br>(to do it come to computer tile press E and solve minigame)<br>"),t.writeln("<br>if you ready press enter")},execute:function(t){return switchToGame(),game.explosions.startExplosions(),!0}},{command:"math",init:function(t){this.num=Math.floor(1e3*Math.random()),this.num2=Math.floor(1e3*Math.random()),this.correctAnswer=this.num+this.num2,this.terminal=t,t.writeln("Count it!<br>"+this.num+" + "+this.num2)},execute:function(t){return t==this.correctAnswer?(this.terminal.writeln("Correct answer!"),!0):(this.terminal.writeln("Wrong answer!"),!1)}},{command:"hangman",init:function(t){const e=["google","amazon","ebay","apple","microsoft"];this.word=e[randomArrayIndex(e)],this.terminal=t,this.wrongGuesses=0,this.guessingState=[];for(let t=0;t<this.word.length;t++)this.guessingState[t]="_";t.writeln("The hang man! You have 2 wrong guesses possible<br> on 3rd you loose<br>Answers are famous IT companies<br> ");this.gallow=" ____       <br>|    |      <br>|           <br>|           <br>|           <br>|           <br>|___        <br>|   |______ <br>|          |<br>|__________|<br>",t.writeln(this.gallow,"div","hangman"),t.writeln(),this.guessingState.forEach(e=>t.writeln(e+" ","span")),t.writeln(),t.scrollDown()},execute:function(t){let e=!1;for(let i=0;i<this.word.length;i++)this.word[i]==t&&(this.guessingState[i]=t,e=!0);return this.updateGallow(e,this.terminal),this.guessingState.forEach(t=>this.terminal.writeln(t+" ","span")),this.terminal.writeln("<br>"),terminal.scrollDown(),3==this.wrongGuesses&&(this.terminal.writeln("<br>You've loosed brainlet, Try again!<br>"),this.init(this.terminal)),0==this.guessingState.filter(t=>"_"==t).length},updateGallow:function(t,e){let i=[" |"," o","/|\\"," |","/ \\"];t||(this.wrongGuesses++,this.gallow=replaceOnIndex(this.gallow,20+16*this.wrongGuesses,i[this.wrongGuesses])),e.writeln(this.gallow,"div","hangman")}},{command:"fallout",init:function(t){this.WORDS=["dupa1234","password","vaultboy","predator","pasionn4","12341234","sadboy34","reptilians","thejava","better","than","cesharp","emacsby","sendmail","thanos"],this.terminal=t,this.terminal.writeln("You write password from set given below if it was correct<br> you win if not it gives you information how <br>similiar was your password to correct password"),this.correctPassword=randomArrayElement(this.WORDS),t.terminal.innerHTML+="<div class='fallout'>",this.WORDS.forEach(e=>t.writeln(e+"\t","span","wrap")),t.terminal.innerHTML+="</div><br>"},execute:function(t){return-1==this.WORDS.indexOf(t)?(this.terminal.writeln("<br>You have to choose password from given set"),!1):this.calcSimiliarity(t)==this.correctPassword.length?(this.terminal.writeln("<br>Correct password<br>"),!0):(this.terminal.writeln("<br>The password is similiar in "+this.calcSimiliarity(t)+" letters"),!1)},calcSimiliarity:function(t){let e=0;for(let i=0;i<this.correctPassword.length;i++)this.correctPassword[i]==t[i]&&e++;return e}},{command:"like",init:function(t){this.terminal=t,t.writeln("Do you like the game? [Yes/No]")},execute:function(t){return"yes"==t?(terminal.writeln("You've thought it's as easy?<br> Try again"),!1):"no"==t||void 0}}];function replaceOnIndex(t,e,i){let n=t,o=e+i.length;return n.substring(0,e)+i+n.substring(o,t.length)}function randomArrayElement(t){return t[randomArrayIndex(t)]}class ComputerTile{constructor(t,e,i,n=48,o=48){this.computerTI=t,this.tileWidth=n,this.tileHeight=o,this.doorIndexes=e,this.command=i,this.disabled=!1}isCollidingWith(t,e){let i=this.computerTI.x*this.tileWidth,n=this.computerTI.y*this.tileHeight,o=t.realPosition.x+t.width/2>=i&&t.realPosition.x+t.width/2<=i+this.tileWidth,a=t.realPosition.y+t.height/2>=n&&t.realPosition.y+t.height/2<=n+this.tileHeight;return o&&a}onWin(){game.tileEngine.layers[1].data[this.doorIndexes[0].x+100*this.doorIndexes[0].y]=0,game.tileEngine.layers[1].data[this.doorIndexes[1].x+100*this.doorIndexes[1].y]=0,game.tileEngine.layers[1].data[this.doorIndexes[2].x+100*this.doorIndexes[2].y]=0,game.tileEngine.prerender(),switchToGame(),marineMates.forEach(t=>t.jump(-100))}}class ComputerTileManager{constructor(t){this.tileEngine=t;let e=new ComputerTile(kontra.vector(15,17),[kontra.vector(20,20),kontra.vector(20,21),kontra.vector(20,22)],"math"),i=new ComputerTile(kontra.vector(41,15),[kontra.vector(46,20),kontra.vector(46,21),kontra.vector(46,22)],"hangman"),n=new ComputerTile(kontra.vector(55,19),[kontra.vector(66,20),kontra.vector(66,21),kontra.vector(66,22)],"fallout"),o=new ComputerTile(kontra.vector(84,3),[kontra.vector(95,20),kontra.vector(95,21),kontra.vector(95,22)],"like");this.tiles=[e,i,n,o]}connectIfPosiible(t){this.tiles.filter(e=>e.isCollidingWith(t,this.tileEngine)).map(t=>terminal.execute(t.command,t)).forEach(t=>switchToTerminal())}}class ActionTile{constructor(t,e){this.tileId=t,this.enabled=!0,this.triggerAction=e}trigger(t){this.enabled&&this.triggerAction(t)}disable(){this.enabled=!1}}let jumpTile=new ActionTile(24,function(t){jumpSound.play(),t.stateMachine.setState("jump"),t.height=50,t.velocity.y=-8.5}),freezeTile=new ActionTile(49,function(t){t.runSpeedFactor=.1,t.jumpSpeedFactor=.25}),teleport=new ActionTile(59,function(t){t==marine?gameWin():t.ttl=0}),slipTile=new ActionTile(10,function(t){t.runSpeedFactor=1.4,t.slipImpact=.01,t.MAX_RUN_SPEED=5}),ACTION_TILES=[jumpTile,freezeTile,slipTile,teleport];class CollisionDetector{canGoRight(t,e){let i=kontra.vector(t.x+t.width-5+t.padding,t.y),n=kontra.vector(i.x,i.y+t.height/2),o=kontra.vector(i.x,i.y),a=kontra.vector(i.x,i.y+t.height-5),s=this.collidesWith([n,o,a],e);return this.findAndTriggerActionTiles(t,s),!includesAny(s,BLOCKING_TILES)}canGoLeft(t,e){let i=kontra.vector(t.x+5+t.padding,t.y),n=kontra.vector(i.x,i.y+t.height/2),o=kontra.vector(i.x,i.y),a=kontra.vector(i.x,i.y+t.height-5),s=this.collidesWith([n,o,a],e);return this.findAndTriggerActionTiles(t,s),!includesAny(s,BLOCKING_TILES)}canGoUp(t,e){let i=kontra.vector(t.x,t.y-1),n=kontra.vector(i.x+t.width/2,i.y),o=this.collidesWith([n],e);return this.findAndTriggerActionTiles(t,o),!includesAny(o,BLOCKING_TILES)}canGoDown(t,e){let i=kontra.vector(t.x-1,t.y+t.height),n=kontra.vector(i.x+t.width/2,i.y),o=kontra.vector(i.x+t.width/6,i.y),a=kontra.vector(i.x+5*t.width/6,i.y),s=this.collidesWith([n,o,a],e);return this.findAndTriggerActionTiles(t,s),!includesAny(s,BLOCKING_TILES)}canGoXD(t,e){return e.x>0?this.canGoRight(t,e):this.canGoLeft(t,e)}canGoXY(t,e){return e.y>0?this.canGoDown(t,e):this.canGoUp(t,e)}collidesWith(t,e){let i=[];for(let n of t){n.add(e);let t=game.tileEngine.collides(n.x,n.y);i=i.concat(t)}return i}findAndTriggerActionTiles(t,e){let i=ACTION_TILES.map(t=>t.tileId);t.slipImpact=1,t.runSpeedFactor=1,t.jumpSpeedFactor=1,t.MAX_RUN_SPEED=2.2;for(let n=0;n<e.length;n++){let o=i.indexOf(e[n]);-1!=o&&ACTION_TILES[o].trigger(t)}}}kontra={init(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");if(!e)throw Error("You must provide a canvas element for the game");this.context=e.getContext("2d"),this._init()},_noop:new Function,_tick:new Function,_init:new Function},kontra.gameLoop=function(t){if(!(t=t||{}).update||!t.render)throw Error("You must provide update() and render() functions");let e,i,n,o,a=t.fps||60,s=0,r=1e3/a,h=1/a,c=!1===t.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function l(){if(i=requestAnimationFrame(l),n=performance.now(),o=n-e,e=n,!(o>1e3)){for(kontra._tick(),s+=o;s>=r;)d.update(h),s-=r;c(),d.render()}}let d={update:t.update,render:t.render,isStopped:!0,start(){e=performance.now(),this.isStopped=!1,requestAnimationFrame(l)},stop(){this.isStopped=!0,cancelAnimationFrame(i)},_frame:l,set _last(t){e=t}};return d},function(){let t={},e={},n={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let t=0;t<26;t++)n[65+t]=(10+t).toString(36);for(i=0;i<10;i++)n[48+i]=""+i;addEventListener("keydown",function(i){let o=n[i.which];e[o]=!0,t[o]&&t[o](i)}),addEventListener("keyup",function(t){e[n[t.which]]=!1}),addEventListener("blur",function(t){e={}}),kontra.keys={bind(e,i){[].concat(e).map(function(e){t[e]=i})},unbind(e,i){[].concat(e).map(function(e){t[e]=i})},pressed:t=>!!e[t]}}();class Vector{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=((t,e)=>new Vector(t,e)),kontra.vector.prototype=Vector.prototype;class Sprite{init(t,e,i,n){for(e in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=kontra.context,t)this[e]=t[e];if(i=t.image)this.image=i,this.width=i.width,this.height=i.height;else if(i=t.animations){for(e in i)this.animations[e]=i[e].clone(),n=n||i[e];this._ca=n,this.width=n.width,this.height=n.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let e=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,n=t.x,o=t.y;return t.anchor&&(n-=t.width*t.anchor.x,o-=t.height*t.anchor.y),e<n+t.width&&e+this.width>n&&i<o+t.height&&i+this.height>o}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.ttl--,this._ca&&this._ca.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,t,e):this._ca?this._ca.render({x:t,y:e,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}kontra.sprite=(t=>(new Sprite).init(t)),kontra.sprite.prototype=Sprite.prototype,function(){let t,e=/(jpeg|jpg|gif|png)$/,i=/(wav|mp3|ogg|aac)$/,n=/^no$/,o=/^\//,a=/\/$/,s=new Audio,r={wav:"",mp3:s.canPlayType("audio/mpeg;").replace(n,""),ogg:s.canPlayType('audio/ogg; codecs="vorbis"').replace(n,""),aac:s.canPlayType("audio/aac;").replace(n,"")};function h(t,e){return[t.replace(a,""),t?e.replace(o,""):e].filter(t=>t).join("/")}function c(t){return t.split(".").pop()}function l(t){let e=t.replace("."+c(t),"");return 2==e.split("/").length?e.replace(o,""):e}function d(e,i){return new Promise(function(n,o){let a=new Image;i=h(t.imagePath,e),a.onload=function(){let o=t._u(i,window.location.href);t.images[l(e)]=t.images[i]=t.images[o]=this,n(this)},a.onerror=function(){o("Unable to load image "+i)},a.src=i})}function m(e,i,n){return new Promise(function(o,a){if(e=[].concat(e).reduce(function(t,e){return r[c(e)]?e:t},n)){let n=new Audio;i=h(t.audioPath,e),n.addEventListener("canplay",function(){let n=t._u(i,window.location.href);t.audio[l(e)]=t.audio[i]=t.audio[n]=this,o(this)}),n.onerror=function(){a("Unable to load audio "+i)},n.src=i,n.load()}else a("cannot play any of the audio formats provided"+e)})}function u(e,i){return i=h(t.dataPath,e),fetch(i).then(function(t){if(!t.ok)throw t;return t.clone().json().catch(function(){return t.text()})}).then(function(n){let o=t._u(i,window.location.href);return"object"==typeof n&&t._d.set(n,o),t.data[l(e)]=t.data[i]=t.data[o]=n,n})}t=kontra.assets={images:{},audio:{},data:{},_d:new WeakMap,_u:(t,e)=>new URL(t,e).href,imagePath:"",audioPath:"",dataPath:"",load(){let t,n,o,a,s,r=[];for(a=0;o=arguments[a];a++)s=(n=c(t=[].concat(o)[0])).match(e)?d(o):n.match(i)?m(o):u(o),r.push(s);return Promise.all(r)},_canUse:r}}(),kontra.pool=function(t){let e,i=0;if(!(t=t||{}).create||!(e=t.create())||!(e.update&&e.init&&e.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");return{_c:t.create,objects:[t.create()],size:1,maxSize:t.maxSize||1/0,get(t){if(t=t||{},this.objects[0].isAlive()){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let e=this.objects.shift();e.init(t),this.objects.push(e),i++},getAliveObjects(){return this.objects.slice(this.objects.length-i)},clear(){i=this.objects.length=0,this.size=1,this.objects.push(this._c())},update(t){let e,n=this.size-1,o=Math.max(this.objects.length-i,0);for(;n>=o;)(e=this.objects[n]).update(t),e.isAlive()?n--:(this.objects=this.objects.splice(n,1).concat(this.objects),i--,o++)},render(){let t=Math.max(this.objects.length-i,0);for(let e=this.size-1;e>=t;e--)this.objects[e].render()}}},function(){let t,e=[],i=[],n={},o=[],a={},s={0:"left",1:"middle",2:"right"};function r(e){let i=e.x,n=e.y;e.anchor&&(i-=e.width*e.anchor.x,n-=e.height*e.anchor.y);let o=t.x-Math.max(i,Math.min(t.x,i+e.width)),a=t.y-Math.max(n,Math.min(t.y,n+e.height));return o*o+a*a<t.radius*t.radius}function h(){let n,o,a=i.length?i:e;for(let e=a.length-1;e>=0;e--)if(o=(n=a[e]).collidesWithPointer?n.collidesWithPointer(t):r(n))return n}function c(t){let e=void 0!==t.button?s[t.button]:"left";a[e]=!0,u(t,"onDown")}function l(t){let e=void 0!==t.button?s[t.button]:"left";a[e]=!1,u(t,"onUp")}function d(t){u(t,"onOver")}function m(t){a={}}function u(e,i){if(!kontra.canvas)return;let o,a;-1!==e.type.indexOf("mouse")?(o=e.pageX,a=e.pageY):(o=(e.touches[0]||e.changedTouches[0]).pageX,a=(e.touches[0]||e.changedTouches[0]).pageY);let s=o-kontra.canvas.offsetLeft,r=a-kontra.canvas.offsetTop,c=kontra.canvas;for(;c=c.offsetParent;)s-=c.offsetLeft,r-=c.offsetTop;let l,d=kontra.canvas.offsetHeight/kontra.canvas.height;s/=d,r/=d,t.x=s,t.y=r,e.target===kontra.canvas&&(e.preventDefault(),(l=h())&&l[i]&&l[i](e)),n[i]&&n[i](e,l)}t=kontra.pointer={x:0,y:0,radius:5,track(t){[].concat(t).map(function(t){t._r||(t._r=t.render,t.render=function(){e.push(this),this._r()},o.push(t))})},untrack(t,e){[].concat(t).map(function(t){t.render=t._r,t._r=e;let i=o.indexOf(t);-1!==i&&o.splice(i,1)})},over:t=>-1!==o.indexOf(t)&&h()===t,onDown(t){n.onDown=t},onUp(t){n.onUp=t},pressed:t=>!!a[t]},kontra._tick=function(){i.length=0,e.map(function(t){i.push(t)}),e.length=0},kontra._init=function(){kontra.canvas.addEventListener("mousedown",c),kontra.canvas.addEventListener("touchstart",c),kontra.canvas.addEventListener("mouseup",l),kontra.canvas.addEventListener("touchend",l),kontra.canvas.addEventListener("blur",m),kontra.canvas.addEventListener("mousemove",d),kontra.canvas.addEventListener("touchmove",d)}}(),kontra.quadtree=function(t){return{maxDepth:(t=t||{}).maxDepth||3,maxObjects:t.maxObjects||25,_b:!1,_d:t.depth||0,_p:t.parent,bounds:t.bounds||{x:0,y:0,width:kontra.canvas.width,height:kontra.canvas.height},objects:[],subnodes:[],clear(){this.subnodes.map(function(t){t.clear()}),this._b=!1,this.objects.length=0},get(t){let e,i,n=[];for(;this.subnodes.length&&this._b;){for(e=this._g(t),i=0;i<e.length;i++)n.push.apply(n,this.subnodes[e[i]].get(t));return n}return this.objects},add(){let t,e,i,n;for(e=0;e<arguments.length;e++)if(i=arguments[e],Array.isArray(i))this.add.apply(this,i);else if(this._b)this._a(i);else if(this.objects.push(i),this.objects.length>this.maxObjects&&this._d<this.maxDepth){for(this._s(),t=0;n=this.objects[t];t++)this._a(n);this.objects.length=0}},_a(t,e,i){for(e=this._g(t),i=0;i<e.length;i++)this.subnodes[e[i]].add(t)},_g(t){let e=[],i=this.bounds.x+this.bounds.width/2,n=this.bounds.y+this.bounds.height/2,o=t.y<n&&t.y+t.height>=this.bounds.y,a=t.y+t.height>=n&&t.y<this.bounds.y+this.bounds.height;return t.x<i&&t.x+t.width>=this.bounds.x&&(o&&e.push(0),a&&e.push(2)),t.x+t.width>=i&&t.x<this.bounds.x+this.bounds.width&&(o&&e.push(1),a&&e.push(3)),e},_s(t,e,i){if(this._b=!0,!this.subnodes.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this.subnodes[i]=kontra.quadtree({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},depth:this._d+1,maxDepth:this.maxDepth,maxObjects:this.maxObjects,parent:this})}}},function(){class t{constructor(t,e){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameRate=t.frameRate,this.loop=void 0===t.loop||t.loop,e=t.spriteSheet.frame,this.width=e.width,this.height=e.height,this.margin=e.margin||0,this._f=0,this._a=0}clone(){return kontra.animation(this)}reset(){this._f=0,this._a=0}update(t){if(this.loop||this._f!=this.frames.length-1)for(t=t||1/60,this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render(t){t=t||{};let e=this.frames[this._f]/this.spriteSheet._f|0,i=this.frames[this._f]%this.spriteSheet._f|0;(t.context||kontra.context).drawImage(this.spriteSheet.image,i*this.width+(2*i+1)*this.margin,e*this.height+(2*e+1)*this.margin,this.width,this.height,t.x,t.y,this.width,this.height)}}kontra.animation=function(e){return new t(e)},kontra.animation.prototype=t.prototype;class e{constructor(t){if(!(t=t||{}).image)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t.image,this.frame={width:t.frameWidth,height:t.frameHeight,margin:t.frameMargin},this._f=t.image.width/t.frameWidth|0,this.createAnimations(t.animations)}createAnimations(t){let e,i,n,o;for(o in t){if(i=(e=t[o]).frames,n=[],void 0===i)throw Error("Animation "+o+" must provide a frames property");[].concat(i).map(function(t){n=n.concat(this._p(t))},this),this.animations[o]=kontra.animation({spriteSheet:this,frames:n,frameRate:e.frameRate,loop:e.loop})}}_p(t,e){if(+t===t)return t;let i=[],n=t.split(".."),o=e=+n[0],a=+n[1];if(o<a)for(;e<=a;e++)i.push(e);else for(;e>=a;e--)i.push(e);return i}}kontra.spriteSheet=function(t){return new e(t)},kontra.spriteSheet.prototype=e.prototype}(),kontra.tileEngine=function(t){let e=t.width*t.tilewidth,i=t.height*t.tileheight,n=document.createElement("canvas"),o=n.getContext("2d");n.width=e,n.height=i;let a={},s={},r=Object.assign({mapwidth:e,mapheight:i,_sx:0,_sy:0,get sx(){return this._sx},get sy(){return this._sy},set sx(t){this._sx=Math.min(Math.max(0,t),e-kontra.canvas.width)},set sy(t){this._sy=Math.min(Math.max(0,t),i-kontra.canvas.height)},render(){d(n)},renderLayer(t){let n=s[t],o=a[t];n||((n=document.createElement("canvas")).width=e,n.height=i,s[t]=n,r._r(o,n.getContext("2d"))),d(n)},layerCollidesWith(t,e){let i=h(e.y),n=c(e.x),o=h(e.y+e.height),s=c(e.x+e.width),r=a[t];for(let t=i;t<=o;t++)for(let e=n;e<=s;e++)if(r.data[e+t*this.width])return!0;return!1},tileAtLayer(t,e){let i=e.row||h(e.y),n=e.col||c(e.x);return a[t]?a[t].data[n+i*r.width]:-1},_r:function(t,e){e.save(),e.globalAlpha=t.opacity,t.data.forEach((t,i)=>{if(!t)return;let n;for(let e=r.tilesets.length-1;e>=0&&(n=r.tilesets[e],!(t/n.firstgid>=1));e--);let o=n.tilewidth||r.tilewidth,a=n.tileheight||r.tileheight,s=n.margin||0,h=n.image,c=t-n.firstgid,l=n.columns||h.width/(o+s)|0,d=i%r.width*o,m=(i/r.width|0)*a,u=c%l*(o+s),p=(c/l|0)*(a+s);e.drawImage(h,u,p,o,a,d,m,o,a)}),e.restore()},layerCanvases:s},t);function h(t){return(r.sy+t)/r.tileheight|0}function c(t){return(r.sx+t)/r.tilewidth|0}function l(){r.layers&&r.layers.forEach(t=>{a[t.name]=t,!1!==t.visible&&r._r(t,o)})}function d(t){(r.context||kontra.context).drawImage(t,r.sx,r.sy,kontra.canvas.width,kontra.canvas.height,0,0,kontra.canvas.width,kontra.canvas.height)}return r.tilesets.forEach(e=>{let i=(kontra.assets?kontra.assets._d.get(t):"")||window.location.href;if(e.source){let t=kontra.assets.data[kontra.assets._u(e.source,i)];Object.keys(t).forEach(i=>{e[i]=t[i]})}if(""+e.image===e.image){let t=kontra.assets.images[kontra.assets._u(e.image,i)];e.image=t}}),r.prerender=l,l(),r};class Expolosion extends Sprite{constructor(t,e,i){super(),this.realX=e,this.realY=i,this.movementSpeed=0,super.init({x:e,y:i,animations:t.animations})}update(t){this.realX+=this.movementSpeed*t,this.x=this.realX-game.tileEngine.sx,this.y=this.realY-game.tileEngine.sy,super.update()}collidesWithMarine(){}}class Expolosions{constructor(t,e){this.explosionsSound=this.createExplosionsSound();this.x=0,this.movementSpeed=0;let i=[],n=0,o=1;for(let a=0;a<e;a++){let e=this.x+200*Math.random()-1e3,s=80+48*n;i[a]=new Expolosion(t,e,s),n>20?(n=0,o++,this.x+=60):n++}this.height=1320,this.width=68*o,this.x-=800,this.expolosions=i}isCollidingWith(t){let e=t.realPosition.x+t.width/2>=this.x-this.width&&t.realPosition.x+t.width/2<=this.x,i=t.realPosition.y+t.height/2>=100&&t.realPosition.y+t.height/2<=300+this.height;return e&&i}startExplosions(){this.movementSpeed=15,this.expolosions.forEach(t=>t.movementSpeed=15),this.explosionsSound.forEach(t=>t.play())}createExplosionsSound(){let t=[];for(let e=0;e<5;e++)t[e]=new Audio("boom.mp3"),t[e].loop=!0,t[e].volume=Math.random(),t[e].baseVolume=t[e].volume,t[e].currentTime=.3*e+Math.random();return t}mute(){this.explosionsSound.forEach(t=>t.loop=!1)}changeRandomExplosionPosition(){if(Math.random()>.7){let e=randomArrayIndex(this.expolosions);this.expolosions[e]._ca.reset();var t=Math.random()<.5?-1:1;this.expolosions[e].x+=20*Math.random()*t,this.expolosions[e].y+=20*Math.random()*t}}fitVolumeToMarineDistance(){let t=2/((marine.realPosition.x-this.x)/48),e=Math.limit(Math.abs(t),1);this.explosionsSound.forEach(t=>t.volume=t.baseVolume*e)}update(t){this.x+=this.movementSpeed*t,this.changeRandomExplosionPosition(),this.fitVolumeToMarineDistance(),this.expolosions.forEach(e=>{e.update(t)}),this.collidesWithMarine()}collidesWithMarine(){this.isCollidingWith(marine)&&(marine.playAnimation("die"),dyingSound.play(),window.setTimeout(()=>{gameLose()},2e3));for(let t=0;t<marineMates.length;t++)if(this.isCollidingWith(marineMates[t])&&!marineMates.died){marineMates[t].died=!0,marineMates[t].playAnimation("die"),dyingSound.play();let e=marineMates[t];window.setTimeout(()=>{let t=marineMates.indexOf(e);-1!=t&&marineMates.remove(t,t)},2e3)}0==marineMates.filter(t=>!t.died).length&&gameLose()}render(t){this.expolosions.forEach(t=>{t.render()})}}function randomArrayIndex(t){return Math.floor(Math.random()*t.length)%t.length}class Character extends Sprite{constructor(t,e,i,n=!0,o=0,a=1,s=-100){super(),this.collisionDetector=new CollisionDetector,this.padding=o,this.realPosition=kontra.vector(t,e),this.animations=i,this.runSpeedFactor=a,this.jumpSpeed=s,super.init({x:t,y:e,animations:i}),this.stateMachine=new MovingStateMachine(this),this.slipImpact=1,this.MAX_RUN_SPEED=2.4,this.AI=n,this.died=!1,this.jumpSpeedFactor=1}render(){super.render()}updateAnimation(t,e,i){t&&t.update(e)}updatePosition(t,e){if(this.velocity.add(this.acceleration,t),this.collisionDetector.canGoXD(this,this.velocity)){let t=kontra.vector(this.velocity.x,0);this.realPosition.add(t)}else this.velocity.x=0,this.AI&&!this.died&&this.stop();if(this.collisionDetector.canGoXY(this,this.velocity)){let t=kontra.vector(0,this.velocity.y);this.realPosition.add(t)}else this.stateMachine.currentState==commands.jump&&this.stateMachine.changeState("stay",0),this.velocity.y=0,this.AI&&(this.velocity.y=-.1);this.acceleration=kontra.vector(0,0)}run(t){this.died||this.stateMachine.changeState("run",t)}jump(t){this.stateMachine.changeState("jump",t)}duck(){this.stateMachine.changeState("duck",0)}stop(){this.stateMachine.changeState("stay",0)}limitRunSpeed(t){let e=Math.min(Math.abs(t.x),this.MAX_RUN_SPEED*this.runSpeedFactor);t.x=e*Math.sign(t.x)}update(t,e,i=0){this.acceleration.add(kontra.vector(0,8)),this.acceleration.add(groundFriction(this.velocity,1.4*this.slipImpact)),this.limitRunSpeed(this.velocity),this.updatePosition(t,i),this.updateAnimation(this._ca,t,this.ttl),this.position=kontra.vector(this.realPosition.x-e.x,this.realPosition.y-e.y)}}const TERRAIN_MAP=[90,46,46,46,88,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,26,28,28,28,28,26,26,27,27,28,28,28,28,28,28,28,26,28,27,26,28,28,28,27,26,26,27,27,28,28,28,28,28,28,28,26,28,27,26,28,28,28,27,26,26,27,27,28,28,28,28,28,28,28,26,28,27,26,28,28,28,27,26,26,27,27,28,28,28,28,28,28,28,26,28,27,26,28,28,28,27,26,26,27,27,28,28,28,28,28,28,28,26,28,27,26,28,28,28,27,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,16,2,2,2,2,16,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,20,21,51,51,51,21,21,22,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,3,3,2,2,2,2,2,2,16,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,20,21,51,51,51,36,36,22,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,2,2,2,2,2,2,2,16,16,16,2,2,16,16,2,16,16,16,2,4,2,2,2,20,51,51,51,22,2,2,2,16,2,2,16,2,16,2,2,2,2,2,2,2,2,2,0,2,16,16,16,16,16,0,2,0,2,2,2,2,2,2,20,36,51,51,21,21,21,22,2,2,10,10,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,3,3,3,2,2,2,2,2,2,2,16,3,2,4,4,2,2,2,2,2,4,2,2,16,20,51,36,51,22,16,4,4,16,2,2,16,2,16,2,2,2,2,2,2,0,0,2,2,2,2,0,2,2,2,2,2,0,2,2,2,2,2,2,20,21,21,36,16,21,10,10,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,3,3,3,2,2,2,2,2,3,3,2,2,4,4,2,2,2,2,4,4,4,4,20,51,36,36,22,2,3,3,16,3,4,16,2,16,2,2,2,0,2,2,2,2,2,2,2,2,0,2,2,2,3,3,0,3,3,3,2,2,2,20,21,21,21,21,21,21,22,2,2,2,2,2,2,10,10,2,2,10,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,2,2,3,3,3,2,2,2,3,3,3,3,2,4,4,3,2,3,3,2,2,4,4,51,51,36,22,2,16,4,3,3,4,16,4,4,2,2,4,0,2,2,3,3,2,2,2,2,0,2,2,2,2,2,0,0,2,3,2,2,2,20,21,16,21,51,36,21,22,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,2,2,16,16,16,3,3,2,2,3,3,3,3,3,16,4,4,2,2,2,2,2,3,16,4,4,4,2,2,2,16,16,16,16,16,16,16,4,4,4,0,0,4,4,4,4,4,4,4,0,2,16,0,16,0,0,3,3,3,2,2,2,20,36,21,21,21,21,21,22,2,2,3,16,3,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,2,2,3,3,2,2,2,16,16,2,3,3,2,2,16,3,4,2,2,2,2,3,3,3,4,2,2,2,2,2,2,2,2,3,2,3,16,4,4,4,4,0,4,4,4,4,4,4,3,0,3,2,2,3,3,0,3,3,3,3,3,3,3,3,3,3,16,3,3,16,2,3,10,3,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,2,3,3,2,2,2,2,2,3,3,3,3,2,2,16,2,2,2,2,2,2,3,3,3,4,2,2,16,2,2,3,3,3,3,2,2,16,2,4,4,4,0,0,4,4,4,4,4,4,0,2,2,2,2,2,0,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,2,3,3,2,2,2,2,2,2,2,2,2,2,16,16,16,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,2,2,2,2,2,2,16,2,4,4,2,2,4,4,4,0,4,4,4,0,2,0,2,2,2,0,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,2,2,4,4,4,2,16,2,4,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,2,16,16,2,2,4,4,4,4,4,2,2,4,4,2,0,0,16,0,16,4,0,2,2,2,16,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,16,2,2,2,2,2,2,2,2,2,4,2,2,2,3,4,4,4,4,4,4,2,2,16,2,2,2,16,2,2,2,4,4,4,16,4,2,4,2,4,16,2,2,4,4,4,4,2,3,3,3,2,2,4,4,16,4,4,4,2,2,2,2,4,2,4,4,2,0,0,2,4,2,2,2,0,2,2,3,16,2,10,10,10,10,2,2,2,10,10,10,2,2,2,2,10,2,4,16,16,2,2,2,3,3,4,4,4,4,4,4,2,2,2,3,4,4,4,2,2,2,4,4,2,2,2,16,2,2,2,16,2,2,4,16,4,2,2,2,2,2,4,2,16,2,2,2,2,2,2,2,2,2,2,2,16,2,2,4,4,4,2,2,4,4,4,4,0,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,2,2,2,16,3,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,4,2,2,16,16,16,2,16,2,2,2,2,2,16,2,16,2,2,2,2,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,2,2,2,2,2,0,2,16,16,16,16,16,16,16,16,16,16,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,16,16,16,16,16,16,16,16,16,2,2,16,2,2,2,16,2,2,4,4,4,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,2,2,16,2,16,4,16,0,2,16,16,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,16,16,16,16,16,16,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,16,16,16,16,16,16,16,16,16,16,16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,2,2,16,16,2,2,2,2,2,2,2,2,16,2,2,2,2,2,2,2,2,4,16,16,16,16,16,16,16,16,16,2,2,2,2,2,16,16,16,16,16,16,16,2,2,2,2,2,2,2,2,16,2,16,16,2,2,2,2,2,2,3,3,3,20,21,21,21,21,21,22,2,2,3,3,4,25,2,4,4,2,2,2,2,2,2,2,2,4,4,4,2,2,2,2,2,4,4,4,4,4,2,25,16,16,16,16,16,16,16,16,16,16,2,2,3,3,3,3,4,3,3,25,3,3,3,3,3,2,2,16,16,16,16,16,16,16,2,2,2,2,4,4,2,2,2,2,2,2,2,2,25,2,11,12,13,2,2,2,2,3,4,4,4,20,36,36,36,51,21,22,4,2,3,3,2,40,2,2,4,2,2,2,3,3,4,4,4,2,2,3,4,4,4,4,4,4,2,2,3,3,2,40,2,2,2,2,3,3,3,4,4,3,4,4,4,4,2,4,4,2,2,40,2,2,2,2,2,3,4,4,4,4,2,2,4,2,2,2,4,4,2,4,4,4,4,4,4,2,4,4,40,4,2,2,2,2,2,2,2,2,2,2,2,35,36,51,51,51,21,37,2,2,4,4,2,55,2,2,2,4,4,4,4,2,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,55,2,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,4,4,55,4,4,2,2,4,4,4,2,2,2,2,2,4,2,4,4,4,2,2,2,2,2,2,2,2,2,2,2,55,2,2,2,2,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,15,16,16,16,16,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,30,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,73,46,46,46,46,46,46,46,30,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,30,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,30,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,45,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,45,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,45,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,45,46,46,46,46];let ELEMENTS_MAP=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,73,0,0,0,0,0,0,0,58,0,0,0,0,0,0,0,58,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,16,16,16,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,0,1,1,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,16,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,16,0,49,16,49,16,49,16,0,16,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,16,16,0,0,0,0,16,0,0,0,0,0,16,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,0,0,0,0,0,0,0,0,16,0,0,0,0,0,16,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,2,0,0,0,16,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,1,24,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,16,0,0,0,0,0,16,16,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,0,0,0,0,0,0,0,16,0,49,16,49,16,16,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,2,2,2,0,16,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,0,0,0,0,0,0,16,0,2,2,2,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,16,0,2,2,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,49,16,49,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,47,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,16,16,0,0,0,54,0,65,66,0,0,0,0,0,0,0,0,0,0,16,16,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,2,0,61,62,0,0,0,0,0,0,0,39,0,0,0,0,0,0,0,0,0,0,63,64,0,0,0,0,16,0,0,0,0,16,16,0,0,16,0,69,70,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,1,0,0,0,0,76,77,0,0,0,0,0,0,0,54,0,0,0,0,0,0,0,0,0,0,78,79,0,0,1,1,16,0,0,16,0,0,0,0,0,16,0,84,85,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,24,0,0,0,0,0,0,0,1,0,0,16,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49,49,49,49,49,49,49,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49,49,0,0,49,0,49,0,1,16,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,1,0,49,49,49,49,49,49,1,1,1,1,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49,0,0,0,0,0,0,0,54,0,0,0,0,0,0,0,0,0,0,0,49,49,49,0,49,49,49,0,0,0,1,0,0,0,49,49,49,1,0,0,0,0,0,0,0,0,0,0,0,16,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0,2,47,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,49,1,49,1,1,0,0,0,0,0,2,47,0,0,0,0,0,38,0,0,0,0,65,66,0,0,49,49,0,49,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,53,0,0,0,61,62,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,53,0,0,0,0,0,0,0,0,0,0,0,0,61,62,0,0,0,0,0,53,0,0,0,0,69,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,53,1,0,44,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,68,0,0,0,76,77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,68,0,0,0,0,0,0,0,0,0,0,0,0,76,77,0,0,0,0,0,68,0,0,0,0,84,85,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,68,1,0,59,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,89,0,0,0,0,0,0,0,0,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];const BLOCKING_TILES=[15,16,26,8,69,99,27,28,38,68,53,10];let dyingSound=new Audio("mandie.mp3"),jumpSound=new Audio("jump.mp3"),game={tileEngine:void 0};kontra.assets.load("exp2.png").then(t=>game.explosions=new Expolosions(kontra.spriteSheet({image:kontra.assets.images["exp2.png"],frameWidth:64,frameHeight:64,animations:{boom:{frames:"0..15",frameRate:8}}}),110));let terminal=new Terminal(document.getElementById("console"),document.getElementById("input")),computerManager=new ComputerTileManager(game.tileEngine);function friction(t,e){return kontra.vector(-t.x*e,-t.y*e)}function groundFriction(t,e){return 0==Math.floor(t.y)?friction(kontra.vector(t.x,0),e):kontra.vector(0,0)}let canvas=document.getElementById("main"),mainContext=canvas.getContext("2d");kontra.init();let marine=void 0,marineMates=void 0,imagen=new Image;imagen.src="marines.png",imagen.onload=(t=>{Window.spriteSheet=kontra.spriteSheet({image:imagen,frameWidth:50,frameHeight:50,animations:{stayRight:{frames:[0],frameRate:6},stayLeft:{frames:[1],frameRate:6},runRight:{frames:"8..15",frameRate:14},runLeft:{frames:"16..23",frameRate:14},duckRight:{frames:[2],frameRate:6},duckLeft:{frames:[3],frameRate:6},jumpRight:{frames:[4],frameRate:6},jumpLeft:{frames:[5],frameRate:6},die:{frames:[6],frameRate:6}}}),marine=new Character(150,600,Window.spriteSheet.animations),marineMates=[new Character(100,1e3,Object.assign({},Window.spriteSheet.animations),!0,20),new Character(100,1e3,Object.assign({},Window.spriteSheet.animations),!0,400),new Character(200,1e3,Object.assign({},Window.spriteSheet.animations),!0,160),new Character(20,1e3,Object.assign({},Window.spriteSheet.animations),!0,260)]}),Array.prototype.remove=function(t,e){var i=this.slice((e||t)+1||this.length);return this.length=t<0?this.length+t:t,this.push.apply(this,i)},Math.limit=((t,e)=>t>e?e:t);let loop=kontra.gameLoop({update:function(t){marine.update(t,kontra.vector(game.tileEngine.sx,game.tileEngine.sy)),marineMates.forEach(t=>t.run(10)),marineMates.forEach(e=>e.update(t,kontra.vector(game.tileEngine.sx,game.tileEngine.sy))),game.tileEngine.update(t),game.explosions.update(t)},render:function(){game.tileEngine.render(),marine.render(),marineMates.forEach(t=>t.render()),game.explosions.render()}}),img=document.createElement("img");function updateAnimation(t,e,i){t&&t.update(e)}function includesAny(t,e){return t.some(t=>e.includes(t))}img.src="tiles.png",img.onload=function(){game.tileEngine=kontra.tileEngine({tilewidth:48,tileheight:48,width:100,height:26,context:mainContext,tilesets:[{firstgid:1,image:img}],layers:[{name:"ground",data:TERRAIN_MAP},{name:"elements",data:ELEMENTS_MAP}],update:function(t){this.sx=marine.realPosition.x-486,this.sy=marine.realPosition.y-360}}),game.tileEngine.collides=function(t,e){return this.layers.map(t=>t.name).map(i=>this.tileAtLayer(i,{x:t,y:e}))},loop.start()};let playerControlsUp=t=>{const e=t.key;t.preventDefault(),"ArrowRight"===e?marine.stateMachine.currentState==commands.run&&marine.stop():"ArrowLeft"===e&&marine.stateMachine.currentState==commands.run&&marine.stop()},playerControlsDown=t=>{const e=t.key;t.preventDefault(),"ArrowRight"===e?marine.run(180):"ArrowLeft"===e?marine.run(-180):"ArrowUp"===e?marine.jump(-360):"ArrowDown"===e?marine.duck():"Tab"===e?switchToTerminal():"e"===e&&computerManager.connectIfPosiible(marine)};function switchToTerminal(){document.removeEventListener("keydown",playerControlsDown),document.removeEventListener("keyup",playerControlsUp),terminal.focus()}function switchToGame(){document.addEventListener("keydown",playerControlsDown,!1),document.addEventListener("keyup",playerControlsUp,!1)}function gameWin(){loop.stop(),game.explosions.mute(),window.setTimeout(function(){end("You won with "+marineMates.length+" teammates")},200)}function gameLose(){loop.stop(),game.explosions.mute(),window.setTimeout(function(){end("You loosed")},200)}function end(t){mainContext.fillStyle="#000000",mainContext.fillRect(0,0,1024,768),mainContext.font="60px Arial",mainContext.fillStyle="#FFFFFF",mainContext.fillText(t,200,340)}switchToTerminal(),terminal.execute("start");